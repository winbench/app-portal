"use strict";window.setImmediate||(window.setImmediate=window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var a=[void 0],r="zero-timeout-message";return window.addEventListener("message",function(t){if("string"==typeof t.data&&t.data.substr(0,r.length)===r){t.stopImmediatePropagation();var e=parseInt(t.data.substr(r.length),36);a[e]&&(a[e](),a[e]=void 0)}},!0),window.clearImmediate=function(t){a[t]&&(a[t]=void 0)},function(t){var e=a.length;return a.push(t),window.postMessage(r+e.toString(36),"*"),e}}()||function(t){window.setTimeout(t,0)}),window.clearImmediate||(window.clearImmediate=window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}),function(t){var s=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return!!e&&(!!e.getImageData&&(!!e.fillText&&(!!Array.prototype.some&&!!Array.prototype.push)))}(),A=function(){if(s){for(var t,e,a=document.createElement("canvas").getContext("2d"),r=20;r;){if(a.font=r.toString(10)+"px sans-serif",a.measureText("Ｗ").width===t&&a.measureText("m").width===e)return r+1;t=a.measureText("Ｗ").width,e=a.measureText("m").width,r--}return 0}}(),v=function(t){for(var e,a,r=t.length;r;e=Math.floor(Math.random()*r),a=t[--r],t[r]=t[e],t[e]=a);return t},e=function(M,t){if(s){Array.isArray(M)||(M=[M]),M.forEach(function(t,e){if("string"==typeof t){if(M[e]=document.getElementById(t),!M[e])throw"The element id specified is not found."}else if(!t.tagName&&!t.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var E={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(t)for(var e in t)e in E&&(E[e]=t[e]);if("function"!=typeof E.weightFactor){var a=E.weightFactor;E.weightFactor=function(t){return t*a}}if("function"!=typeof E.shape)switch(E.shape){case"circle":default:E.shape="circle";break;case"cardioid":E.shape=function(t){return 1-Math.sin(t)};break;case"diamond":E.shape=function(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"square":E.shape=function(t){return Math.min(1/Math.abs(Math.cos(t)),1/Math.abs(Math.sin(t)))};break;case"triangle-forward":E.shape=function(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":E.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":E.shape=function(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":E.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return 0<=(t+.955)%(2*Math.PI/5)-2*Math.PI/10?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}E.gridSize=Math.max(Math.floor(E.gridSize),4);var w,g,p,x,b,C,I,S,P=E.gridSize,i=P-E.maskGapWidth,d=Math.abs(E.maxRotation-E.minRotation),c=Math.abs(Math.floor(E.rotationSteps)),u=Math.min(E.maxRotation,E.minRotation);switch(E.color){case"random-dark":I=function(){return o(10,50)};break;case"random-light":I=function(){return o(50,90)};break;default:"function"==typeof E.color&&(I=E.color)}"function"==typeof E.fontWeight&&(S=E.fontWeight);var T=null;"function"==typeof E.classes&&(T=E.classes);var k,y=!1,F=[],r=function(t){var e,a,r=t.currentTarget,o=r.getBoundingClientRect();t.touches?(e=t.touches[0].clientX,a=t.touches[0].clientY):(e=t.clientX,a=t.clientY);var i=e-o.left,n=a-o.top,s=Math.floor(i*(r.width/o.width||1)/P),f=Math.floor(n*(r.height/o.height||1)/P);return F[s][f]},R=function(t){var e=r(t);k!==e&&((k=e)?E.hover(e.item,e.dimension,t):E.hover(void 0,void 0,t))},L=function(t){var e=r(t);e&&(E.click(e.item,e.dimension,t),t.preventDefault())},n=[],h=function(t){if(n[t])return n[t];var e=8*t,a=e,r=[];for(0===t&&r.push([x[0],x[1],0]);a--;){var o=1;"circle"!==E.shape&&(o=E.shape(a/e*2*Math.PI)),r.push([x[0]+t*o*Math.cos(-a/e*2*Math.PI),x[1]+t*o*Math.sin(-a/e*2*Math.PI)*E.ellipticity,a/e*2*Math.PI])}return n[t]=r},O=function(){return 0<E.abortThreshold&&(new Date).getTime()-C>E.abortThreshold},m=function(t,e,a,r,o){if(!(g<=t||p<=e||t<0||e<0)){if(w[t][e]=!1,a)M[0].getContext("2d").fillRect(t*P,e*P,i,i);y&&(F[t][e]={item:o,dimension:r})}},z=function(r){var o,i,n;Array.isArray(r)?(o=r[0],i=r[1]):(o=r.word,i=r.weight,n=r.attributes);var s=0===E.rotateRatio?0:Math.random()>E.rotateRatio?0:0===d?u:0<c?u+Math.floor(Math.random()*c)*d/(c-1):u+Math.random()*d,f=function(t,e,a){var r=E.weightFactor(e);if(r<=E.minSize)return!1;var o,i=1;r<A&&(i=function(){for(var t=2;t*r<A;)t+=2;return t}()),o=S?S(t,e,r):E.fontWeight;var n=document.createElement("canvas"),s=n.getContext("2d",{willReadFrequently:!0});s.font=o+" "+(r*i).toString(10)+"px "+E.fontFamily;var f=s.measureText(t).width/i,l=Math.max(r*i,s.measureText("m").width,s.measureText("Ｗ").width)/i,d=f+2*l,c=3*l,u=Math.ceil(d/P),h=Math.ceil(c/P);d=u*P,c=h*P;var m=-f/2,v=.4*-l,w=Math.ceil((d*Math.abs(Math.sin(a))+c*Math.abs(Math.cos(a)))/P),g=Math.ceil((d*Math.abs(Math.cos(a))+c*Math.abs(Math.sin(a)))/P),M=g*P,p=w*P;n.setAttribute("width",M),n.setAttribute("height",p),s.scale(1/i,1/i),s.translate(M*i/2,p*i/2),s.rotate(-a),s.font=o+" "+(r*i).toString(10)+"px "+E.fontFamily,s.fillStyle="#000",s.textBaseline="middle",s.fillText(t,m*i,(v+.5*r)*i);var x=s.getImageData(0,0,M,p).data;if(O())return!1;for(var b,C,I,T=[],k=g,y=[w/2,g/2,w/2,g/2];k--;)for(b=w;b--;){I=P;t:for(;I--;)for(C=P;C--;)if(x[4*((b*P+I)*M+(k*P+C))+3]){T.push([k,b]),k<y[3]&&(y[3]=k),k>y[1]&&(y[1]=k),b<y[0]&&(y[0]=b),b>y[2]&&(y[2]=b);break t}}return{mu:i,occupied:T,bounds:y,gw:g,gh:w,fillTextOffsetX:m,fillTextOffsetY:v,fillTextWidth:f,fillTextHeight:l,fontSize:r}}(o,i,s);if(!f)return!1;if(O())return!1;if(!E.drawOutOfBound){var t=f.bounds;if(t[1]-t[3]+1>g||t[2]-t[0]+1>p)return!1}for(var l=b+1,e=function(t){var e=Math.floor(t[0]-f.gw/2),a=Math.floor(t[1]-f.gh/2);f.gw,f.gh;return!!function(t,e,a,r,o){for(var i=o.length;i--;){var n=t+o[i][0],s=e+o[i][1];if(g<=n||p<=s||n<0||s<0){if(!E.drawOutOfBound)return!1}else if(!w[n][s])return!1}return!0}(e,a,0,0,f.occupied)&&(function(f,l,d,c,t,e,a,u,h){var m,v,w,g=d.fontSize;m=I?I(c,t,g,e,a):E.color,v=S?S(c,t,g):E.fontWeight,w=T?T(c,t,g):E.classes;var r=d.bounds;r[3],r[0],r[1],r[3],r[2],r[0],M.forEach(function(t){if(t.getContext){var e=t.getContext("2d"),a=d.mu;e.save(),e.scale(1/a,1/a),e.font=v+" "+(g*a).toString(10)+"px "+E.fontFamily,e.fillStyle=m,e.translate((f+d.gw/2)*P*a,(l+d.gh/2)*P*a),0!==u&&e.rotate(-u),e.textBaseline="middle",e.fillText(c,d.fillTextOffsetX*a,(d.fillTextOffsetY+.5*g)*a),e.restore()}else{var r=document.createElement("span"),o="";o="rotate("+-u/Math.PI*180+"deg) ",1!==d.mu&&(o+="translateX(-"+d.fillTextWidth/4+"px) scale("+1/d.mu+")");var i={position:"absolute",display:"block",font:v+" "+g*d.mu+"px "+E.fontFamily,left:(f+d.gw/2)*P+d.fillTextOffsetX+"px",top:(l+d.gh/2)*P+d.fillTextOffsetY+"px",width:d.fillTextWidth+"px",height:d.fillTextHeight+"px",lineHeight:g+"px",whiteSpace:"nowrap",transform:o,webkitTransform:o,msTransform:o,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};for(var n in m&&(i.color=m),r.textContent=c,i)r.style[n]=i[n];if(h)for(var s in h)r.setAttribute(s,h[s]);w&&(r.className+=w),t.appendChild(r)}})}(e,a,f,o,i,b-l,t[2],s,n),function(t,e,a,r,o,i){var n,s,f=o.occupied,l=E.drawMask;if(l&&((n=M[0].getContext("2d")).save(),n.fillStyle=E.maskColor),y){var d=o.bounds;s={x:(t+d[3])*P,y:(e+d[0])*P,w:(d[1]-d[3]+1)*P,h:(d[2]-d[0]+1)*P}}for(var c=f.length;c--;){var u=t+f[c][0],h=e+f[c][1];g<=u||p<=h||u<0||h<0||m(u,h,l,s,i)}l&&n.restore()}(e,a,0,0,f,r),!0)};l--;){var a=h(b-l);if(E.shuffle&&(a=[].concat(a),v(a)),a.some(e))return!0}return!1},W=function(a,r,o){if(r)return!M.some(function(t){var e=document.createEvent("CustomEvent");return e.initCustomEvent(a,!0,r,o||{}),!t.dispatchEvent(e)},this);M.forEach(function(t){var e=document.createEvent("CustomEvent");e.initCustomEvent(a,!0,r,o||{}),t.dispatchEvent(e)},this)};!function(){var e=M[0];if(e.getContext)g=Math.ceil(e.width/P),p=Math.ceil(e.height/P);else{var t=e.getBoundingClientRect();g=Math.ceil(t.width/P),p=Math.ceil(t.height/P)}if(W("wordcloudstart",!0)){var a,r,o,i,n;if(x=E.origin?[E.origin[0]/P,E.origin[1]/P]:[g/2,p/2],b=Math.floor(Math.sqrt(g*g+p*p)),w=[],!e.getContext||E.clearCanvas)for(M.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=E.backgroundColor,e.clearRect(0,0,g*(P+1),p*(P+1)),e.fillRect(0,0,g*(P+1),p*(P+1))}else t.textContent="",t.style.backgroundColor=E.backgroundColor,t.style.position="relative"}),a=g;a--;)for(w[a]=[],r=p;r--;)w[a][r]=!0;else{var s=document.createElement("canvas").getContext("2d");s.fillStyle=E.backgroundColor,s.fillRect(0,0,1,1);var f,l,d=s.getImageData(0,0,1,1).data,c=e.getContext("2d").getImageData(0,0,g*P,p*P).data;for(a=g;a--;)for(w[a]=[],r=p;r--;){l=P;t:for(;l--;)for(f=P;f--;)for(o=4;o--;)if(c[4*((r*P+l)*g*P+(a*P+f))+o]!==d[o]){w[a][r]=!1;break t}!1!==w[a][r]&&(w[a][r]=!0)}c=s=d=void 0}if(E.hover||E.click){for(y=!0,a=g+1;a--;)F[a]=[];E.hover&&e.addEventListener("mousemove",R);var u=function(t){t.preventDefault()};E.click&&(e.addEventListener("click",L),e.addEventListener("touchstart",L),e.addEventListener("touchend",u),e.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),e.addEventListener("wordcloudstart",function t(){e.removeEventListener("wordcloudstart",t),e.removeEventListener("mousemove",R),e.removeEventListener("click",L),e.removeEventListener("touchstart",L),e.removeEventListener("touchend",u),k=void 0})}(o=0)!==E.wait?(i=window.setTimeout,n=window.clearTimeout):(i=window.setImmediate,n=window.clearImmediate);var h=function(e,a){M.forEach(function(t){t.removeEventListener(e,a)},this)},m=function t(){h("wordcloudstart",t),n(v)};!function(e,a){M.forEach(function(t){t.addEventListener(e,a)},this)}("wordcloudstart",m);var v=i(function t(){if(o>=E.list.length)return n(v),W("wordcloudstop",!1),void h("wordcloudstart",m);C=(new Date).getTime();var e=z(E.list[o]),a=!W("wordclouddrawn",!0,{item:E.list[o],drawn:e});if(O()||a)return n(v),E.abort(),W("wordcloudabort",!1),W("wordcloudstop",!1),void h("wordcloudstart",m);o++,v=i(t,E.wait)},E.wait)}}()}function o(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}};e.isSupported=s,e.minFontSize=A,"function"==typeof define&&define.amd?(t.WordCloud=e,define("wordcloud",[],function(){return e})):"undefined"!=typeof module&&module.exports?module.exports=e:t.WordCloud=e}(this);